<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="./css/main.css" />
    <title>Toyota Sales Form</title>
    <script>
      function getConfirmation() {
        var returnVal = confirm("Do you want to really exit ?");
        if (returnVal === true) {
          document.getElementById("body").style.display = "none";
        } else {
          return false;
        }
      }
      function sales() {
        // Variables for keeping the form values
        var record = document.salesForm;
        var customerId = record.customerId.value;
        var name = record.name.value;
        var town = record.town.value;
        var partNumber = record.partNumber.value;
        var description = record.description.value;
        var pricePerPart = record.pricePerPart.value;
        var quantity = record.quantity.value;
        var shipping = document.salesForm.shipping.value;
        var oversize = document.salesForm.oversize;
        var cost = (pricePerPart * quantity).toFixed(2);

        // This function validate the input fields
        function validData() {
          var pattern1 = /\s/;
          var pattern2 = /[^0-9]/;

          if (!customerId || customerId.match(pattern1)) {
            document.getElementById("customerId").innerHTML =
              " Invalid Customer ID";
            return false;
          } else if (!name) {
            document.getElementById("name").innerHTML =
              " Invalid Customer name";
            return false;
          } else if (town.length != 3) {
            document.getElementById("town").innerHTML =
              " Town code must be 3 characters";
            return false;
          } else if (!partNumber) {
            document.getElementById("partNumber").innerHTML =
              " Part Number cannot be missing";
            return false;
          } else if (!description) {
            document.getElementById("description").innerHTML =
              " Description cannot be missing";
            return false;
          } else if (isNaN(pricePerPart) || pricePerPart <= 0) {
            document.getElementById("pricePerPart").innerHTML = "Invalid price";
            return false;
          } else if (pattern2.test(quantity) || quantity <= 0) {
            document.getElementById("quantity").innerHTML = "Invalid quantity";
          } else {
            return salesTax(cost);
          }
        }

        // Function to compute the amount of the sales tax
        function salesTax(amount) {
          // This sends the cost to browser
          document.getElementById("cost").innerHTML = `$ ${cost}`;

          this.cost = amount;
          // Calculating the sales tax for Kampala, Mbarara, Entebbe and other towns
          if (town === "KLA") {
            tax = this.cost * 0.1;
          } else if (town === "EBB" || town === "MBR") {
            tax = this.cost * 0.05;
          } else {
            tax = 0.0;
          }

          // This send the Sales Tax to the browser
          document.getElementById("salesTax").innerHTML = `$ ${tax.toFixed(2)}`;

          // getter for the total tax
          this.getTax = function() {
            return tax;
          };

          return shippingHandling();
        }

        // Function to compute cost of shipping and handling
        function shippingHandling() {
          // Calculating the shipping cost
          if (shipping === "UPS") {
            shippingCost = 7.0;
          } else if (shipping === "Fed Ex Ground") {
            shippingCost = 8.5;
          } else if (shipping === "US Portal Air") {
            shippingCost = 9.25;
          } else {
            shippingCost = 12.0;
          }

          // Extra handling cost for oversize container
          if (oversize.checked) {
            handlingCost = 5.0;
          } else {
            handlingCost = 0.0;
          }

          // Calculating the total shipping and handling cost
          totalShippingCost = (
            quantity *
            (shippingCost + handlingCost)
          ).toFixed(2);

          // This sends the total shipping and handling cost to the browser
          document.getElementById(
            "handling"
          ).innerHTML = `$ ${totalShippingCost}`;

          // getter for total shipping cost
          this.getShippingCost = function() {
            return totalShippingCost;
          };

          return totalCost();
        }

        // Function to calculate the total cost
        function totalCost() {
          // Total cost = cost + tax + shipping cost
          var total = (
            parseFloat(cost) +
            parseFloat(window.tax + parseFloat(window.totalShippingCost))
          ).toFixed(2);

          document.getElementById("total").innerHTML = `$ ${total}`;
        }

        validData();
        return false;
      }
    </script>
    <style>
      /* Styling container div */
      form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-gap: 1em;
        padding: 20px;
        margin: 50px 100px;
        background: #f5cef2;
      }

      .box {
        background: #c98954;
        padding: 0px;
        height: 200px;
        width: 545px;
      }

      fieldset {
        border: 4px solid #fff;
        height: 180px;
        margin: 0px;
      }

      /* Customer Information Section */
      .customerInfo {
        display: grid;
        grid-template-columns: 1fr 3fr;
        grid-gap: 0.8em;
        background: #c98954;
        padding: 10px;
        margin-top: 20px;
      }

      .customerInfo .long {
        grid-column: 2/3;
        justify-self: start;
      }

      .long input {
        width: 150px;
      }

      /* Shipping Section  */
      .shipping {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-gap: 0.8em;
        background: #c98954;
        padding: 10px;
        margin-top: 20px;
      }

      /* Part Ordered Section */
      .partOrdered {
        display: grid;
        grid-template-columns: 1fr 3fr;
        grid-gap: 0.8em;
        background: #c98954;
        padding: 10px;
      }

      .partOrdered div:last-child {
        grid-column: 1/3;
        justify-self: center;
      }

      .partOrdered .pricePerPart {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-gap: 0.5em;
      }

      /* Output Section */
      .output {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-gap: 0.8em;
        background: #c98954;
        padding: 10px;
      }

      .output > div:nth-child(even) {
        background: #fff;
        margin: 0px;
        text-align: right;
        padding: 5px;
      }

      /* Bottom Section */
      .bottom {
        display: grid;
        grid-template-columns: 1fr 1fr 3fr 1fr;
        grid-column: 1/3;
        grid-gap: 0.2em;
        margin-right: 0px;
        padding-right: 0px;
      }

      .bottom div:last-child {
        justify-self: end;
      }
      /* styling all the input fields of button and reset */
      input[type="button"],
      input[type="reset"],
      input[type="submit"] {
        width: 150px;
        height: 30px;
        border-radius: 5%;
        background: #c98954;
      }

      input[type="button"]:hover,
      input[type="reset"]:hover,
      input[type="submit"]:hover {
        border: dotted #094fac 2px;
      }

      input[type="button"]:focus,
      input[type="reset"]:focus,
      input[type="submit"]:focus {
        border: dotted #094fac 2px;
      }

      /* Styling the error messages */

      #customerId,
      #name,
      #town,
      #partNumber,
      #description,
      #pricePerPart,
      #quantity,
      #space {
        color: #0914ac;
        font-weight: bold;
        font-style: italic;
        margin: 0px;
      }

      /* body {
  display: none;
} */
    </style>
  </head>
  <body id="body">
    <form name="salesForm" onsubmit="return sales()">
      <div class="box">
        <fieldset>
          <legend>Customer Information</legend>
          <div class="customerInfo">
            <div>
              <label>Customer ID:</label>
            </div>
            <div>
              <input type="text" name="customerId" placeholder="123-45-6789" />
              <span id="customerId"></span>
            </div>
            <div>
              <label>Name:</label>
            </div>
            <div class="long">
              <input type="text" name="name" />
              <span id="name"></span>
            </div>
            <div>
              <label>Town</label>
            </div>
            <div>
              <input
                type="text"
                name="town"
                oninput="this.value=this.value.toUpperCase()"
                maxlength="3"
              />
              <input
                type="checkbox"
                checked
                name="retailCustomer"
                value="Retail Customer"
              />
              <span>Retail Customer</span>
              <p id="town"></p>
            </div>
          </div>
        </fieldset>
      </div>
      <div class="box">
        <fieldset>
          <legend>Shipping</legend>
          <div class="shipping">
            <div>
              <input type="radio" name="shipping" value="UPS" checked />
              <span>UPS</span>
            </div>
            <div>
              <input type="radio" name="shipping" value="Fed Ex Ground" />
              <span>Fed Ex Ground</span>
            </div>
            <div>
              <input type="radio" name="shipping" value="US Portal Air" />
              <span>US Portal Air</span>
            </div>
            <div>
              <input type="radio" name="shipping" value="Fed Ex Air" />
              <span>Fed Ex Air</span>
            </div>
          </div>
        </fieldset>
      </div>
      <div class="box">
        <fieldset>
          <legend>Part Ordered</legend>
          <div class="partOrdered">
            <div>Part Number:</div>
            <div>
              <input type="text" name="partNumber" />
              <span id="partNumber"></span>
            </div>
            <div>Description:</div>
            <div>
              <input type="text" name="description" />
              <span id="description"></span>
            </div>
            <div>Price per part:</div>
            <div class="pricePerPart">
              <input type="text" name="pricePerPart" />
              <label>Quantity:</label>
              <input type="text" name="quantity" />
              <p id="pricePerPart"></p>
              <p id="space"></p>
              <p id="quantity"></p>
            </div>
            <div>
              <input
                type="checkbox"
                name="oversize"
                value="Oversize Container"
              />
              <span>Oversize Container?</span>
            </div>
          </div>
        </fieldset>
      </div>
      <div class="box">
        <fieldset>
          <legend>Output</legend>
          <div class="output">
            <div>Cost:</div>
            <div id="cost"></div>
            <div>Sales Tax:</div>
            <div id="salesTax"></div>
            <div>Shipping and Handling:</div>
            <div id="handling"></div>
            <div>Total:</div>
            <div id="total"></div>
          </div>
        </fieldset>
      </div>
      <div class="bottom">
        <div>
          <input type="submit" value="Compute" name="compute" />
        </div>
        <div>
          <input type="reset" value="New Order" name="newOrder" />
        </div>
        <div></div>
        <div>
          <input
            type="button"
            value="exit"
            name="exit"
            onclick="getConfirmation()"
          />
        </div>
      </div>
    </form>
  </body>
</html>
